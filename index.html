

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Django Ecstatic! &mdash; django-ecstatic 1.0a1 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1.0a1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="django-ecstatic 1.0a1 documentation" href="#" />
    <link rel="next" title="Settings" href="settings.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="settings.html" title="Settings"
             accesskey="N">next</a> |</li>
        <li><a href="#">django-ecstatic 1.0a1 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="django-ecstatic">
<h1>Django Ecstatic!<a class="headerlink" href="#django-ecstatic" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="a-quick-tour">
<h1>A Quick Tour<a class="headerlink" href="#a-quick-tour" title="Permalink to this headline">¶</a></h1>
<p>django-ecstatic is an expansion pack for <tt class="docutils literal"><span class="pre">django.contrib.staticfiles</span></tt>!
Read the full documentation at <a class="reference external" href="http://django-ecstatic.readthedocs.org/">readthedocs</a>.</p>
<p>Here are some things it can do:</p>
<ul class="simple">
<li>Eliminate the need for network connections to calculate file hashes.</li>
<li>Collect only the static files that have changed.</li>
<li>Add a static building step to your Django workflow.</li>
<li>Add content hashes to your filenames, without failing on non-existent files.</li>
<li>Create static manifests to reduce network operations and ease deployment.</li>
</ul>
<p>Ecstatic&#8217;s utlities are written with the same interfaces as
<tt class="docutils literal"><span class="pre">django.contrib.staticfiles</span></tt>, so they should be compatible with your favorite
Django storage libraries.</p>
<div class="section" id="hashed-filenames-ftw">
<h2>Hashed Filenames FTW<a class="headerlink" href="#hashed-filenames-ftw" title="Permalink to this headline">¶</a></h2>
<p>First of all, you should already be using Django&#8217;s CachedFilesMixin or
<a class="reference external" href="https://docs.djangoproject.com/en/dev/ref/contrib/staticfiles/#cachedstaticfilesstorage">CachedStaticFilesStorage</a> classes, which add a post-processing step to the
<cite>collectstatic</cite> command that saves a copy of your static files with a hash of
their contents in the filename. If you&#8217;re serving the files yourself, this will
allow you to set <a class="reference external" href="https://www.google.com/search?q=far+future+expiration">far-future expirations</a> for your assets, which will make
your site&#8217;s users happy. It also means that new versions of assets won&#8217;t
overwrite the old versions, which would break your site if the deployed code and
static files aren&#8217;t in sync.</p>
<p>However, in order to get the content hash, these classes will open the file
using your app&#8217;s <a class="reference external" href="https://docs.djangoproject.com/en/dev/ref/settings/#staticfiles-storage">STATICFILES_STORAGE</a>. If you&#8217;re using a CDN, this means
they&#8217;ll be performing network operations. But those static files are saved on
the local filesystem, too—after all, they were collected from somewhere. That&#8217;s
where <tt class="docutils literal"><span class="pre">ecstatic.storage.CachedStaticFilesMixin</span></tt> and
<tt class="docutils literal"><span class="pre">ecstatic.storage.CachedStaticFilesStorage</span></tt> come in. Instead of using the
storage class to get the hash, they&#8217;ll use your app&#8217;s staticfiles finders to
find the local version and use its hash. (They also have a couple of other handy
features.) Use the mixin with the storage class of your choice to get the
benefits:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">ecstatic.storage</span> <span class="kn">import</span> <span class="n">CachedStaticFilesMixin</span>
<span class="kn">from</span> <span class="nn">cumulus.storage</span> <span class="kn">import</span> <span class="n">CloudFilesStaticStorage</span>


<span class="k">class</span> <span class="nc">MyStaticFilesStorage</span><span class="p">(</span><span class="n">CachedStaticFilesMixin</span><span class="p">,</span> <span class="n">CloudFilesStaticStorage</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
</div>
<div class="section" id="building-static-files">
<h2>Building Static Files<a class="headerlink" href="#building-static-files" title="Permalink to this headline">¶</a></h2>
<p>Sooner or later, you&#8217;re going to need to add a build step to your Django apps;
whether it&#8217;s because of <a class="reference external" href="http://sass-lang.com/">Sass</a>, <a class="reference external" href="http://lesscss.org/">Less</a>, <a class="reference external" href="http://coffeescript.org/">Coffee</a>, <a class="reference external" href="http://requirejs.org/docs/whyamd.html">AMD</a>, or just to optimize your
PNGs and JPEGs. There are a <a class="reference external" href="https://github.com/jezdez/django_compressor">few</a> <a class="reference external" href="https://github.com/cyberdelia/django-pipeline">popular</a> ways to do some of these things with
Django, but each has its own specific goals, and you can easily find your build
requirements outside of their scope. Ecstatic takes a different approach by
giving you a simple way to add a build step to your workflow, but has absolutely
no opinion about what that build step should be, making it easy to take
advantage of whatever build tools you want.</p>
<p>The heart of the Ecstatic build step is the <tt class="docutils literal"><span class="pre">buildstatic</span></tt> management command,
and it is stupid simple. In fact, it only does two things: first, it collects
your static files into a build directory and, second, it runs some shell
commands. (Seriously, look at <a class="reference external" href="https://github.com/hzdg/django-ecstatic/blob/master/ecstatic/management/commands/buildstatic.py">the source</a>. It delegates most of its work to
Django&#8217;s <tt class="docutils literal"><span class="pre">collectstatic</span></tt>. And that&#8217;s A Good Thing.)</p>
<p>To specify the build directory, use the <tt class="docutils literal"><span class="pre">ECSTATIC_BUILD_ROOT</span></tt> setting:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">ECSTATIC_BUILD_ROOT</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">),</span> <span class="s">&#39;static_built&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>To specify a list of shell commands to run with the <tt class="docutils literal"><span class="pre">ECSTATIC_BUILD_COMMANDS</span></tt>
setting:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">ECSTATIC_BUILD_COMMANDS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s">&#39;coffee -c /path/to/build_dir&#39;</span><span class="p">,</span>
    <span class="s">&#39;uglifyjs /path/to/build_dir/a.js -c &gt; /path/to/build_dir/a.js&#39;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
<p>or (to keep things a little more tidy):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">ECSTATIC_BUILD_COMMANDS</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;./bin/mybuildscript&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Finally, you&#8217;ll need to add a special finder to your <tt class="docutils literal"><span class="pre">STATICFILES_FINDERS</span></tt>
list:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">STATICFILES_FINDERS</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s">&#39;ecstatic.finders.BuiltFileFinder&#39;</span><span class="p">,</span>

    <span class="c"># The default Django finders:</span>
    <span class="s">&#39;django.contrib.staticfiles.finders.FileSystemFinder&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.staticfiles.finders.AppDirectoriesFinder&#39;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>This finder is important—it&#8217;s how Django finds the built versions of your files
when you run <tt class="docutils literal"><span class="pre">collectstatic</span></tt>.</p>
</div>
<div class="section" id="hashed-filenames-and-built-files">
<h2>Hashed Filenames and Built Files<a class="headerlink" href="#hashed-filenames-and-built-files" title="Permalink to this headline">¶</a></h2>
<p>Remember when I mentioned how <tt class="docutils literal"><span class="pre">ecstatic.storage.CachedStaticFilesMixin</span></tt> and
<tt class="docutils literal"><span class="pre">ecstatic.storage.CachedStaticFilesStorage</span></tt> worked? They calculate the hashes
of the local versions of the static files. Obviously, then, the local
versions—that is, the static files on your app server—need to be the same as the
ones you collected to your CDN. Otherwise, the app server would get different
hashes and use the wrong URL! So if you&#8217;re building your static files, you need
to make sure that the built files are on your app server. There are two ways
to do this:</p>
<ol class="arabic simple">
<li>Include your <tt class="docutils literal"><span class="pre">STATIC_BUILD</span></tt> directory in your package and deploy it with
the rest of your application code.</li>
<li>Re-build the static files on the app server.</li>
</ol>
<p>Alternatively, you can go back to using
<tt class="docutils literal"><span class="pre">django.contrib.staticfiles.storage.CachedFilesMixin</span></tt> or
<tt class="docutils literal"><span class="pre">django.contrib.staticfiles.storage.CachedStaticFilesStorage</span></tt>, though then
you&#8217;re back in the situation of using network operations to get the hash.</p>
<p>All of the above options have pros and cons. If you deploy directly from
version control, option 1 would mean committing compiled files to your
repository, which you may consider bloat. On the other hand, option 2 means that
your app server needs to have all of your build tools installed. It also means
that there will be some time while new code is deployed, but it&#8217;s referencing
old assets (until the build completes so the storage can get the new hash).</p>
<p>Luckily, Ecstatic has another solution:
<tt class="docutils literal"><span class="pre">ecstatic.storage.StaticManifestMixin</span></tt>. This mixin is used just like
<tt class="docutils literal"><span class="pre">ecstatic.storage.CachedStaticFilesMixin</span></tt>, but it looks up your static files
URLs in a manifest file—completely sidestepping the need to calculate the hash
of the local files.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">ecstatic.storage</span> <span class="kn">import</span> <span class="n">CachedStaticFilesMixin</span><span class="p">,</span> <span class="n">StaticManifestMixin</span>
<span class="kn">from</span> <span class="nn">cumulus.storage</span> <span class="kn">import</span> <span class="n">CloudFilesStaticStorage</span>


<span class="k">class</span> <span class="nc">MyStaticFilesStorage</span><span class="p">(</span><span class="n">StaticManifestMixin</span><span class="p">,</span> <span class="n">CachedStaticFilesMixin</span><span class="p">,</span> <span class="n">CloudFilesStaticStorage</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Notice that we&#8217;re still including <tt class="docutils literal"><span class="pre">CachedStaticFilesMixin</span></tt>. It&#8217;s still
needed for the post-processing, and to figure out which URL should be
inserted into the manifest.</p>
</div>
<p>With this mixin, the storage no longer needs access to the built files to
determine their hashes (and therefore URLs); it only needs to access the
manifest file. That means:</p>
<ul class="simple">
<li>You don&#8217;t need to package your built static files with your app.</li>
<li>You don&#8217;t need to install your build tools on your app server.</li>
<li>The storage class can lookup the new URL as soon as new code is deployed
(along with a new staticfiles manifest).</li>
<li>We still aren&#8217;t performing network operations to get hashes/URLs.</li>
</ul>
<p>In other words, we&#8217;ve solved all of our issues. Yay!</p>
<p>So how do you create this manifest? First, you need to add a variable to your
settings.py file to let Ecstatic know where to create it:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">ECSTATIC_MANIFEST_FILE</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">),</span> <span class="s">&#39;staticmanifest.json&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Then just run the <tt class="docutils literal"><span class="pre">createstaticmanifest</span></tt> management command:</p>
<div class="highlight-sh"><div class="highlight"><pre>./manage.py createstaticmanifest
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When you run <tt class="docutils literal"><span class="pre">createstaticmanifest</span></tt>, make sure that the Django settings
you&#8217;re using contain the correct <tt class="docutils literal"><span class="pre">STATICFILES_STORAGE</span></tt>. If you have a
local_settings.py that sets a different <tt class="docutils literal"><span class="pre">STATICFILES_STORAGE</span></tt>, the
manifest will contain the URLs that it reports!</p>
</div>
</div>
</div>
<div class="section" id="contents">
<h1>Contents<a class="headerlink" href="#contents" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="settings.html">Settings</a><ul>
<li class="toctree-l2"><a class="reference internal" href="settings.html#storage-settings">Storage Settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="settings.html#build-settings">Build Settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="settings.html#manifest-settings">Manifest Settings</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="storages.html">Storages</a></li>
<li class="toctree-l1"><a class="reference internal" href="commands.html">Management Commands</a><ul>
<li class="toctree-l2"><a class="reference internal" href="commands.html#buildstatic">buildstatic</a></li>
<li class="toctree-l2"><a class="reference internal" href="commands.html#collectnewstatic">collectnewstatic</a></li>
<li class="toctree-l2"><a class="reference internal" href="commands.html#createstaticmanifest">createstaticmanifest</a></li>
<li class="toctree-l2"><a class="reference internal" href="commands.html#hashmedianames">hashmedianames</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="indices-and-tables">
<h1>Indices and tables<a class="headerlink" href="#indices-and-tables" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><a class="reference internal" href="genindex.html"><em>Index</em></a></li>
<li><a class="reference internal" href="py-modindex.html"><em>Module Index</em></a></li>
<li><a class="reference internal" href="search.html"><em>Search Page</em></a></li>
</ul>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="#">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Django Ecstatic!</a></li>
<li><a class="reference internal" href="#a-quick-tour">A Quick Tour</a><ul>
<li><a class="reference internal" href="#hashed-filenames-ftw">Hashed Filenames FTW</a></li>
<li><a class="reference internal" href="#building-static-files">Building Static Files</a></li>
<li><a class="reference internal" href="#hashed-filenames-and-built-files">Hashed Filenames and Built Files</a></li>
</ul>
</li>
<li><a class="reference internal" href="#contents">Contents</a><ul>
</ul>
</li>
<li><a class="reference internal" href="#indices-and-tables">Indices and tables</a></li>
</ul>

  <h4>Next topic</h4>
  <p class="topless"><a href="settings.html"
                        title="next chapter">Settings</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/index.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="settings.html" title="Settings"
             >next</a> |</li>
        <li><a href="#">django-ecstatic 1.0a1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Matthew Tretter.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>